
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>2.12 - Breakout (part 2) · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="02-13-breakout-part-3.html" />
    
    
    <link rel="prev" href="02-11-breakout-part-1.html" />
    

    <script src="../gitbook/gitbook-plugin-graph/d3.min.js"></script>
    <script src="../gitbook/gitbook-plugin-graph/function-plot.js"></script>    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="01-00-programming-basics.html">
            
                <a href="01-00-programming-basics.html">
            
                    
                    1.0 - Programming basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="01-01-interactive-coding.html">
            
                <a href="01-01-interactive-coding.html">
            
                    
                    1.1 - Interactive coding
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="01-02-strings.html">
            
                <a href="01-02-strings.html">
            
                    
                    1.2 - Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="01-03-nil-and-variables.html">
            
                <a href="01-03-nil-and-variables.html">
            
                    
                    1.3 - Nil and variables
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="01-04-using-functions.html">
            
                <a href="01-04-using-functions.html">
            
                    
                    1.4 - Using functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="01-05-comments-in-code.html">
            
                <a href="01-05-comments-in-code.html">
            
                    
                    1.5 - Comments in code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="01-06-scripting-and-printing.html">
            
                <a href="01-06-scripting-and-printing.html">
            
                    
                    1.6 - Scripting and printing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="01-07-making-functions.html">
            
                <a href="01-07-making-functions.html">
            
                    
                    1.7 - Making functions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="01-08-booleans.html">
            
                <a href="01-08-booleans.html">
            
                    
                    1.8 - Booleans
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="01-09-flow-control.html">
            
                <a href="01-09-flow-control.html">
            
                    
                    1.9 - Flow control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="01-10-while.html">
            
                <a href="01-10-while.html">
            
                    
                    1.10 - While
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.11" data-path="01-11-type-checking.html">
            
                <a href="01-11-type-checking.html">
            
                    
                    1.11 - Type checking
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.12" data-path="01-12-first-game.html">
            
                <a href="01-12-first-game.html">
            
                    
                    1.12 - First game
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.13" data-path="01-13-tables-1.html">
            
                <a href="01-13-tables-1.html">
            
                    
                    1.13 - Tables (part 1)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.14" data-path="01-14-tables-2.html">
            
                <a href="01-14-tables-2.html">
            
                    
                    1.14 - Tables (part 2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.15" data-path="01-15-for-loops-1.html">
            
                <a href="01-15-for-loops-1.html">
            
                    
                    1.15 - For loops (part 1)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.16" data-path="01-16-for-loops-2.html">
            
                <a href="01-16-for-loops-2.html">
            
                    
                    1.16 - For loops (part 2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.17" data-path="01-17-scopes.html">
            
                <a href="01-17-scopes.html">
            
                    
                    1.17 - Scopes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.18" data-path="01-18-chapter-review.html">
            
                <a href="01-18-chapter-review.html">
            
                    
                    1.18 - Chapter review
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="02-00-introducing-love.html">
            
                <a href="02-00-introducing-love.html">
            
                    
                    2.0 - Introducing LÖVE
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="02-01-up-and-running.html">
            
                <a href="02-01-up-and-running.html">
            
                    
                    2.1 - Up and running
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="02-02-love-structure.html">
            
                <a href="02-02-love-structure.html">
            
                    
                    2.2 - LÖVE structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="02-03-geometry.html">
            
                <a href="02-03-geometry.html">
            
                    
                    2.3 - Geometry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="02-04-game-loop.html">
            
                <a href="02-04-game-loop.html">
            
                    
                    2.4 - Game loop
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="02-05-delta-time.html">
            
                <a href="02-05-delta-time.html">
            
                    
                    2.5 - Delta time
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="02-06-mapping.html">
            
                <a href="02-06-mapping.html">
            
                    
                    2.6 - Mapping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="02-07-the-world.html">
            
                <a href="02-07-the-world.html">
            
                    
                    2.7 - The world
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="02-08-reading-documentation.html">
            
                <a href="02-08-reading-documentation.html">
            
                    
                    2.8 - Reading documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="02-09-modules-and-organization.html">
            
                <a href="02-09-modules-and-organization.html">
            
                    
                    2.9 - Modules and organization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="02-10-collision-callbacks.html">
            
                <a href="02-10-collision-callbacks.html">
            
                    
                    2.10 - Collision callbacks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="02-11-breakout-part-1.html">
            
                <a href="02-11-breakout-part-1.html">
            
                    
                    2.11 - Breakout (part 1)
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.12" data-path="02-12-breakout-part-2.html">
            
                <a href="02-12-breakout-part-2.html">
            
                    
                    2.12 - Breakout (part 2)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="02-13-breakout-part-3.html">
            
                <a href="02-13-breakout-part-3.html">
            
                    
                    2.13 - Breakout (part 3)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="02-14-breakout-part-4.html">
            
                <a href="02-14-breakout-part-4.html">
            
                    
                    2.14 - Breakout (part 4)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="02-15-breakout-part-5.html">
            
                <a href="02-15-breakout-part-5.html">
            
                    
                    2.15 - Breakout (part 5)
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >2.12 - Breakout (part 2)</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="breakout-part-2-entity-management">Breakout (part 2): entity management</h1>
<h2 id="review">Review</h2>
<p>In the previous section we made a checklist of requirements and accomplished one of them:</p>
<ul>
<li>The objective of the game is to destroy all the bricks on the screen</li>
<li>The player controls a &quot;paddle&quot; entity that hits a ball</li>
<li>The ball destroys the bricks</li>
<li><strong>&#x2714;</strong> The ball needs to stay within the boundaries of the screen</li>
<li>If the ball touches the bottom of the screen, the game ends</li>
</ul>
<p>In the previous exercise, the goal was to move the boundaries so they were just off screen.
This gives the effect that the ball is bouncing off the edges of the game window.</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/boundary-bottom.lua</span>
entity.body = love.physics.newBody(world, <span class="hljs-number">400</span>, <span class="hljs-number">606</span>, <span class="hljs-string">&apos;static&apos;</span>)
</code></pre>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/boundary-left.lua</span>
entity.body = love.physics.newBody(world, <span class="hljs-number">-6</span>, <span class="hljs-number">300</span>, <span class="hljs-string">&apos;static&apos;</span>)
</code></pre>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/boundary-right.lua</span>
entity.body = love.physics.newBody(world, <span class="hljs-number">806</span>, <span class="hljs-number">300</span>, <span class="hljs-string">&apos;static&apos;</span>)
</code></pre>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/boundary-top.lua</span>
entity.body = love.physics.newBody(world, <span class="hljs-number">400</span>, <span class="hljs-number">-6</span>, <span class="hljs-string">&apos;static&apos;</span>)
</code></pre>
<p>Here they have been moved 6 pixels off screen just to use even numbers and make calculation easier.
Previously we also raised the question of whether or not the boundaries would work if we still <code>require</code>&apos;d them in <strong>main.lua</strong> but didn&apos;t draw them in <code>love.draw</code>.
The answer is they still work but we don&apos;t see them.
Since they are off screen, that doesn&apos;t matter anyway and we can save our program from doing extra work:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- main.lua</span>
love.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">local</span> ball_x, ball_y = ball.body:getWorldCenter()
  love.graphics.circle(<span class="hljs-string">&apos;fill&apos;</span>, ball_x, ball_y, ball.shape:getRadius())
  love.graphics.polygon(<span class="hljs-string">&apos;line&apos;</span>, paddle.body:getWorldPoints(paddle.shape:getPoints()))
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="entity-list">Entity list</h2>
<p>Let&apos;s think about the problem of brick entities for a minute.
We could create an entity file for each brick, but they are more or less the same except that they spawn in different spots.
Imagine making 50 different entity files and then inside <code>love.draw</code> making 50 lines to draw each brick and so on.
What we can instead do is make an entity file for 1 brick then make a list with 50 copies of it (or however many brick copies we end up fitting on the screen).
We can then loop over this list to draw the bricks.</p>
<p>Let&apos;s first create the brick entity file:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/brick.lua</span>

<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x_pos, y_pos)</span></span>
  <span class="hljs-keyword">local</span> entity = {}
  entity.body = love.physics.newBody(world, x_pos, y_pos, <span class="hljs-string">&apos;static&apos;</span>)
  entity.shape = love.physics.newRectangleShape(<span class="hljs-number">50</span>, <span class="hljs-number">20</span>)
  entity.fixture = love.physics.newFixture(entity.body, entity.shape)
  entity.fixture:setUserData(entity)

  <span class="hljs-keyword">return</span> entity
<span class="hljs-keyword">end</span>
</code></pre>
<p>Instead of returning an entity in this file, we returned a function that takes an x-position and y-position as parameters.
When the function gets invoked wherever it is required, it will generate a new entity with those coordinates for its spawn point.
Here&apos;s how we can use it:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- main.lua</span>

<span class="hljs-keyword">local</span> boundary_bottom = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-bottom&apos;</span>)
<span class="hljs-keyword">local</span> boundary_left = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-left&apos;</span>)
<span class="hljs-keyword">local</span> boundary_right = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-right&apos;</span>)
<span class="hljs-keyword">local</span> boundary_top = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-top&apos;</span>)
<span class="hljs-keyword">local</span> paddle = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/paddle&apos;</span>)
<span class="hljs-keyword">local</span> ball = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/ball&apos;</span>)
<span class="hljs-keyword">local</span> brick = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/brick&apos;</span>)

<span class="hljs-keyword">local</span> entities = {
  brick(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">300</span>, <span class="hljs-number">100</span>)
}


<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-comment">-- Boolean to keep track of whether our game is paused or not</span>
<span class="hljs-keyword">local</span> paused = <span class="hljs-keyword">false</span>

<span class="hljs-keyword">local</span> key_map = {
  escape = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    love.event.quit()
  <span class="hljs-keyword">end</span>,
  space = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    paused = <span class="hljs-keyword">not</span> paused
  <span class="hljs-keyword">end</span>
}

love.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">local</span> ball_x, ball_y = ball.body:getWorldCenter()
  love.graphics.circle(<span class="hljs-string">&apos;fill&apos;</span>, ball_x, ball_y, ball.shape:getRadius())
  love.graphics.polygon(<span class="hljs-string">&apos;line&apos;</span>, paddle.body:getWorldPoints(paddle.shape:getPoints()))

  <span class="hljs-keyword">for</span> _, entity <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(entities) <span class="hljs-keyword">do</span>
    love.graphics.polygon(<span class="hljs-string">&apos;fill&apos;</span>, entity.body:getWorldPoints(entity.shape:getPoints()))
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.focus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(focused)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> focused <span class="hljs-keyword">then</span>
    paused = <span class="hljs-keyword">true</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.keypressed = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pressed_key)</span></span>
  <span class="hljs-comment">-- Check in the key map if there is a function</span>
  <span class="hljs-comment">-- that matches this pressed key&apos;s name</span>
  <span class="hljs-keyword">if</span> key_map[pressed_key] <span class="hljs-keyword">then</span>
    key_map[pressed_key]()
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dt)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> paused <span class="hljs-keyword">then</span>
    world:update(dt)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>We made an entity table with a list of brick entities in it, then in <code>love.draw</code> we made a for loop to draw each entity in the list.
Before we change anything else try running the game and taking a look that the bricks appear and that everything works.</p>
<h2 id="rule-of-single-responsibility">Rule of single responsibility</h2>
<p>Our goal for the rest of this section will be to simplify entity management.
One strategy we&apos;ll have for doing this is to think of each file in our game as having a single responsibility.
A good sign that we&apos;re doing this is <strong>main.lua</strong> is very small and easy to scan over with the eyes and digest.</p>
<p>So what is the responsibility of <strong>main.lua</strong>?</p>
<ul>
<li>Create the callback functions necessary to run the game.</li>
</ul>
<p>Here&apos;s some things it is doing that don&apos;t fit that responsibility:</p>
<ul>
<li>Load and store all the entities</li>
<li>Figure out how to draw each type of entity in <code>love.draw</code></li>
<li>Store a map of keypresses</li>
</ul>
<p>Imagine our game is an organization and each file is a role in the company.
Our main file is like the secretary that knows how to handle requests from outsiders.
If somebody called asking the secretary about building-maintenance issues, the secretary wouldn&apos;t grab plumbing tools and take care of the problem but rather dispatch the person whose responsibility is that exact kind of problem.
As the owner of this organization we should know everyone&apos;s roles so it&apos;s easy to know where each responsibility lies.
It will make is easier for us to grow the company to the size we desire.</p>
<p>One easy improvement is to not write out all the instructions for drawing each entity within the main file, but rather let each entity file be responsible for every feature of that entity, including how to draw that entity.
We may want to get fancy later and draw bricks in different colors, for instance.
That could get complicated and we don&apos;t want the main file to retain a bunch of code about brick colors and such.</p>
<p>Modifying the entities is as easy as creating <code>draw</code> functions in the entity tables:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/brick.lua</span>

<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x_pos, y_pos)</span></span>
  <span class="hljs-keyword">local</span> entity = {}
  entity.body = love.physics.newBody(world, x_pos, y_pos, <span class="hljs-string">&apos;static&apos;</span>)
  entity.shape = love.physics.newRectangleShape(<span class="hljs-number">50</span>, <span class="hljs-number">20</span>)
  entity.fixture = love.physics.newFixture(entity.body, entity.shape)
  entity.fixture:setUserData(entity)

  entity.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(self)</span></span>
    love.graphics.polygon(<span class="hljs-string">&apos;fill&apos;</span>, self.body:getWorldPoints(self.shape:getPoints()))
  <span class="hljs-keyword">end</span>

  <span class="hljs-keyword">return</span> entity
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/paddle.lua</span>

<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pos_x, pos_y)</span></span>
  <span class="hljs-keyword">local</span> entity = {}
  entity.body = love.physics.newBody(world, pos_x, pos_y, <span class="hljs-string">&apos;static&apos;</span>)
  entity.shape = love.physics.newRectangleShape(<span class="hljs-number">180</span>, <span class="hljs-number">20</span>)
  entity.fixture = love.physics.newFixture(entity.body, entity.shape)
  entity.fixture:setUserData(entity)

  entity.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(self)</span></span>
    love.graphics.polygon(<span class="hljs-string">&apos;line&apos;</span>, self.body:getWorldPoints(self.shape:getPoints()))
  <span class="hljs-keyword">end</span>

  <span class="hljs-keyword">return</span> entity
<span class="hljs-keyword">end</span>
</code></pre>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities/ball.lua</span>

<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(x_pos, y_pos)</span></span>
  <span class="hljs-keyword">local</span> entity = {}
  entity.body = love.physics.newBody(world, x_pos, y_pos, <span class="hljs-string">&apos;dynamic&apos;</span>)
  entity.body:setMass(<span class="hljs-number">32</span>)
  entity.body:setLinearVelocity(<span class="hljs-number">300</span>, <span class="hljs-number">300</span>)
  entity.shape = love.physics.newCircleShape(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>)
  entity.fixture = love.physics.newFixture(entity.body, entity.shape)
  entity.fixture:setRestitution(<span class="hljs-number">1</span>)
  entity.fixture:setUserData(entity)

  entity.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(self)</span></span>
    <span class="hljs-keyword">local</span> self_x, self_y = self.body:getWorldCenter()
    love.graphics.circle(<span class="hljs-string">&apos;fill&apos;</span>, self_x, self_y, self.shape:getRadius())
  <span class="hljs-keyword">end</span>

  <span class="hljs-keyword">return</span> entity
<span class="hljs-keyword">end</span>
</code></pre>
<p>Go ahead and make <em>all</em> the entities return a function with <code>x_pos</code> and <code>y_pos</code> parameters and we&apos;ll just add everything to the entity list like the bricks.
Don&apos;t forget to change out the numbers in the <code>love.physics.newBody(world, 200, 200, &apos;dynamic&apos;)</code> with the arguments being passed in by the function: <code>love.physics.newBody(world, x_pos, y_pos, &apos;dynamic&apos;)</code>.
For the boundaries entity files there is no need for <code>entity.draw</code> functions, but still make them return functions with the two parameters.
Now update the <code>entities</code> list in <strong>main.lua</strong> to include all the entities:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- main.lua</span>

<span class="hljs-keyword">local</span> boundary_bottom = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-bottom&apos;</span>)
<span class="hljs-keyword">local</span> boundary_left = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-left&apos;</span>)
<span class="hljs-keyword">local</span> boundary_right = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-right&apos;</span>)
<span class="hljs-keyword">local</span> boundary_top = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-top&apos;</span>)
<span class="hljs-keyword">local</span> paddle = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/paddle&apos;</span>)
<span class="hljs-keyword">local</span> ball = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/ball&apos;</span>)
<span class="hljs-keyword">local</span> brick = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/brick&apos;</span>)

<span class="hljs-keyword">local</span> entities = {
  boundary_bottom(<span class="hljs-number">400</span>, <span class="hljs-number">606</span>),
  boundary_left(<span class="hljs-number">-6</span>, <span class="hljs-number">300</span>),
  boundary_right(<span class="hljs-number">806</span>, <span class="hljs-number">300</span>),
  boundary_top(<span class="hljs-number">400</span>, <span class="hljs-number">-6</span>),
  paddle(<span class="hljs-number">300</span>, <span class="hljs-number">500</span>),
  ball(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>),
  brick(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">300</span>, <span class="hljs-number">100</span>)
}


<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)

<span class="hljs-comment">-- Boolean to keep track of whether our game is paused or not</span>
<span class="hljs-keyword">local</span> paused = <span class="hljs-keyword">false</span>

<span class="hljs-keyword">local</span> key_map = {
  escape = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    love.event.quit()
  <span class="hljs-keyword">end</span>,
  space = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
    paused = <span class="hljs-keyword">not</span> paused
  <span class="hljs-keyword">end</span>
}

love.draw = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>
  <span class="hljs-keyword">for</span> _, entity <span class="hljs-keyword">in</span> <span class="hljs-built_in">ipairs</span>(entities) <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">if</span> entity.draw <span class="hljs-keyword">then</span> entity:draw() <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.focus = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(focused)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> focused <span class="hljs-keyword">then</span>
    paused = <span class="hljs-keyword">true</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.keypressed = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(pressed_key)</span></span>
  <span class="hljs-comment">-- Check in the key map if there is a function</span>
  <span class="hljs-comment">-- that matches this pressed key&apos;s name</span>
  <span class="hljs-keyword">if</span> key_map[pressed_key] <span class="hljs-keyword">then</span>
    key_map[pressed_key]()
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

love.update = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(dt)</span></span>
  <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> paused <span class="hljs-keyword">then</span>
    world:update(dt)
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>Take a look at our <code>love.draw</code> function.
It is much simpler now that it no longer needs to know how to draw each entity.
It just asks the entity if it knows how to draw itself and if it does it tells it to do so.
Remember that invoking <code>entity:draw()</code> is just shorthand for writing <code>entity.draw(entity)</code> because of the <code>:</code>.</p>
<p>Ok, but putting the entities in a list didn&apos;t clean up this file.
Now this file is responsible for knowing where to spawn the entities and having them in a list just makes this file bigger.
Well you see the reason we put them in a list is because we want to make a new game file called <strong>entities.lua</strong> that will be responsible for loading, spawning, and storing all the entities when the game starts up.
Create a new file then cut all the entity <code>require</code> statements and the entity list and paste it in the new file:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- entities.lua</span>

<span class="hljs-keyword">local</span> boundary_bottom = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-bottom&apos;</span>)
<span class="hljs-keyword">local</span> boundary_left = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-left&apos;</span>)
<span class="hljs-keyword">local</span> boundary_right = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-right&apos;</span>)
<span class="hljs-keyword">local</span> boundary_top = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/boundary-top&apos;</span>)
<span class="hljs-keyword">local</span> paddle = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/paddle&apos;</span>)
<span class="hljs-keyword">local</span> ball = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/ball&apos;</span>)
<span class="hljs-keyword">local</span> brick = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities/brick&apos;</span>)

<span class="hljs-keyword">return</span> {
  boundary_bottom(<span class="hljs-number">400</span>, <span class="hljs-number">606</span>),
  boundary_left(<span class="hljs-number">-6</span>, <span class="hljs-number">300</span>),
  boundary_right(<span class="hljs-number">806</span>, <span class="hljs-number">300</span>),
  boundary_top(<span class="hljs-number">400</span>, <span class="hljs-number">-6</span>),
  paddle(<span class="hljs-number">300</span>, <span class="hljs-number">500</span>),
  ball(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>),
  brick(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">200</span>, <span class="hljs-number">100</span>),
  brick(<span class="hljs-number">300</span>, <span class="hljs-number">100</span>)
}
</code></pre>
<p>And now the top of our main file only needs to load the entities file and it will have the list to use in <code>love.draw</code> and elsewhere as needed:</p>
<pre><code class="lang-lua"><span class="hljs-comment">-- main.lua</span>

<span class="hljs-keyword">local</span> entities = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;entities&apos;</span>)
<span class="hljs-keyword">local</span> world = <span class="hljs-built_in">require</span>(<span class="hljs-string">&apos;world&apos;</span>)
</code></pre>
<p>When you run the game, you should be seeing something similar to this:
<img src="https://raw.githubusercontent.com/RVAGameJams/learn2love/master/code/breakout-2/screenshot.png" alt=""></p>
<p>If you missed anything or are having issues, here&apos;s a copy of the completed source code for this section:
<a href="https://github.com/RVAGameJams/learn2love/tree/master/code/breakout-2" target="_blank">https://github.com/RVAGameJams/learn2love/tree/master/code/breakout-2</a></p>
<p>And that&apos;s about it for entity management.
We&apos;ll figure out how to handle keypresses for the paddle and everything else in the next section.
We&apos;ll finish the cleanup in our main file while we&apos;re at it.</p>
<h2 id="exercises">Exercises</h2>
<ul>
<li>Now that our entities have passed off knowledge on where they spawn over to <strong>entities.lua</strong>, our left and right boundaries are identical files. Replace <strong>boundary-left.lua</strong> and <strong>boundary-right.lua</strong> with a single <strong>boundary-vertical.lua</strong> file and spawn two copies of that in <strong>entities.lua</strong>. If you get stuck, check out the <strong>entities.lua</strong> file in the next section for how this is done.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="02-11-breakout-part-1.html" class="navigation navigation-prev " aria-label="Previous page: 2.11 - Breakout (part 1)">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="02-13-breakout-part-3.html" class="navigation navigation-next " aria-label="Next page: 2.13 - Breakout (part 3)">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"2.12 - Breakout (part 2)","level":"1.3.12","depth":2,"next":{"title":"2.13 - Breakout (part 3)","level":"1.3.13","depth":2,"path":"pages/02-13-breakout-part-3.md","ref":"pages/02-13-breakout-part-3.md","articles":[]},"previous":{"title":"2.11 - Breakout (part 1)","level":"1.3.11","depth":2,"path":"pages/02-11-breakout-part-1.md","ref":"pages/02-11-breakout-part-1.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["graph"],"pluginsConfig":{"graph":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"pages/02-12-breakout-part-2.md","mtime":"2018-09-20T03:01:53.999Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-09-29T03:17:28.028Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

